version: 1
frontend:
  phases:
    preBuild:
      commands:
        - curl -fsSL https://get.pnpm.io/install.sh | sh -
        - pnpm config set store-dir .pnpm-store
        - echo "Installing dependencies..."
        - timeout 600 pnpm install --frozen-lockfile=false --prefer-offline --reporter=append-only || echo "Install completed with potential issues"
    build:
      commands:
        - export NODE_OPTIONS="--max-old-space-size=6144"
        # Load environment variables for SSR
        - env | grep -e NEXT_PUBLIC_ >> .env.production
        - echo "Starting build process..."
        - timeout 1200 pnpm run build
        - echo "Build completed."
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - .pnpm-store/**
      - node_modules/**
      - pnpm-lock.yaml